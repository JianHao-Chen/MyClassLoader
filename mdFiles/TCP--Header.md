---
title: TCP的首部
category: TCP/IP
---

本文将介绍TCP的首部。

<!--more-->

---



<img src="http://img.blog.csdn.net/20170521165844724">

下面是对TCP首部的各个字段的解释：
1. 源端口，目标端口 (各16位)
**源端口号**标识主机上发起传送的应用程序。**目的端口号**标识主机上传送要到达的应用程序。

2. 序号(32位)
用于标识从TCP发端向TCP收端发送的数据字节流，它表示在这个报文段中的第一个数据字节在数据流中的序号。

3. 确认号(32位)
包含发送确认的一端所期望收到的下一个序号。确认序号应当是上次已成功收到数据字节序号加1。原因是为了确认主机端确实有收到我们 client 端所送出的封包数据，我们 client 端当然希望能够收到主机方面的响应，那就是这个 Acknowledge Number 的用途了。当 client 端收到这个确认码时，就能够确定之前传递的封包已经被正确的收下了。

4. 数据偏移（又叫首部长度，4位）
首部长度给出首部中32bit字的数目。
没有任何选项字段的TCP头部长度为20字节；最多可以有60字节的TCP头部。

5. 状态控制码（Code，Control Flag）
标志位字段（U、A、P、R、S、F）：占6比特。各比特的含义如下：
  * URG
紧急比特（urgent）,当URG＝1时，表明紧急指针字段有效,代表该封包为紧急封包。它告诉系统此报文段中有紧急数据，应尽快传送(相当于高优先级的数据)， 且上图中的 Urgent Pointer 字段也会被启用。
  * ACK
确认比特（Acknowledge）。只有当这个ACK＝1时确认号字段才有效,代表这个封包为确认封包。当ACK＝0时，确认号无效。
  * PSH
（Push function）若为1时，代表要求对方立即传送缓冲区内的其他对应封包，而无需等缓冲满了才送。
  * RST
复位比特(Reset) ,当RST＝1时，表明TCP连接中出现严重差错（如由于主机崩溃或其他原因），必须释放连接，然后再重新建立运输连接。
  * SYN
同步比特(Synchronous)，SYN置为1，就表示这是一个连接请求或连接接受报文,通常带有 SYN 标志的封包表示『主动』要连接到对方的意思。。
  * FIN
终止比特(Final)，用来释放一个连接。当FIN＝1时，表明此报文段的发送端的数据已发送完毕，并要求释放运输连接。

6. 滑动窗口（占16位）
窗口字段用来控制对方发送的数据量，可以告知对方目前本身有的缓冲器容量(Receive Buffer) 还可以接收封包。当 Window=0 时，代表缓冲器已经额满，所以应该要暂停传输数据。单位为字节。TCP连接的一端根据设置的缓存空间大小确定自己的接收窗口大小，然后通知对方以确定对方的发送窗口的上限,这个值是本机期望一次接收的字节数。

7. TCP校验和(Checksum，占2字节)  
当数据要由发送端送出前，会进行一个检验的动作，并将该动作的检验值标注在这个字段上； 而接收者收到这个封包之后，会再次的对封包进行验证，并且比对原发送的 Checksum 值是否相符，如果相符就接受，若不符就会假设该封包已经损毁，进而要求对方重新发送此封包！在计算检验和时，要在TCP报文段的前面加上12字节的伪首部。

8. 紧急指针(Urgent Pointer，占2字节)  
这个字段是在 Code 字段内的 URG = 1 时才会产生作用。可以告知紧急数据所在的位置(紧急指针指出在本报文段中的紧急数据的最后一个字节的序号)。

9. 选项（Options） 长度可变
TCP首部可以有多达40字节的可选信息，用于把附加信息传递给终点，或用来对齐其它选项。
目前此字段仅应用于表示接收端可以接收的最大数据区段容量，若此字段不使用， 表示可以使用任意数据区段的大小。 这个字段较少使用。
TCP首部的主要选项：
最大报文段长度MSS(Maximum Segment Size)，每个连接方通常都在通信的第一个报文段（为建立连接而设置SYN标志的那个段）中指明这个选项。它指明本端所能接受的最大长度的报文段。

10. 填充字段(Padding)
如同 IP 封包需要有固定的 32bits 表头一样， Options 由于字段为非固定， 所以也需要 Padding 字段来加以补齐才行。同样也是 32 bits 的整数。
这是为了使整个首部长度是4字节的整数倍。


